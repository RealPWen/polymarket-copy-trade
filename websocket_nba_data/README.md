## 数据格式说明 (归一化量化视图)

本系统采用与专业量化交易一致的**归一化视角**。Polymarket 的原始数据包含 Yes 和 No Token，我们进行了如下自动转换：

### 1. 自动归一化 (Quant Normalization)
- **Yes Token**: 保持原样。
- **No Token**: 价格自动转换为 `1.0 - Price`。
- **买卖盘对冲**: No 的买单 (Bid) 会转换为 Yes 的卖单 (Ask) 的镜像，确保在一个图表上看到的永远是该事件发生的**逻辑概率**（即 Yes 的等效价格）。
- **结果**: 数据文件和看板中的 `price` 统一代表 "Yes" 的概率。

### 2. 实时过滤器 (Trade Filter)
看板右上角新增了 **"仅显示成交" (Trades Only)** 按钮。
- **开启后**: 屏蔽掉频繁波动的盘口报价 (Quotes)，图表上只绘制发生真实交易的点。
- **关闭后**: 显示完整数据流，包括盘口买卖价的微小移动。

### 3. 冷启动历史补全 (Cold Start Recovery)
系统具备“记忆”能力，不再受重启影响：
- **24h 历史加载**: 每次启动后端时，会自动从本地 Parquet 文件扫描并补全过去 24 小时的成交历史。
- **2000 点缓冲区**: 为每个市场在内存中保留最近 2000 个成交点，确保刷新页面时折线图依然完整。

### 4. 静默运行模式 (Silent Logs)
- **控制台**: 仅打印**系统状态**和**真实成交 (Trades)**，过滤掉高频的盘口报价干扰。
- **背景日志**: 所有的原始报价仍会静默记录在 `logs/` 下的日志文件中供查阅。

这是为你推荐的**极速模式**，支持毫秒级更新和精美图形界面。

```bash
# 进入目录
cd /Users/panwen/Desktop/polymarket/websocket_data

# 给启动脚本权限 (已执行过可跳过)
chmod +x start_live.sh

# 一键启动
./start_live.sh
```

### 运行后会发生什么？
1. **控制台**: 开始显示从 Polymarket 抓取的实时报价和成交。
2. **后端**: 启动一个本地中继服务 (`localhost:8081`)。
3. **前端**: 自动在浏览器打开 `index.html`。
4. **实时连接**: 浏览器会通过 WebSocket 连接到本地后端，你可以看到**永不跳动（不刷新）**、**始终流动**的实时胜率曲线。

---

## 目录与组件详情
- `nba_live_backend.py`: 核心中枢，负责对接 Polymarket 并广播给前端。
- `index.html`: 前端界面，使用深色竞技主题 + ECharts 毫秒级绘图引擎。
- `config.py`: 配置订阅哪些 NBA 市场（目前默认订阅所有赛季级市场）。
- `data/`: 实时抓取的原始数据依然会以 Parquet 格式保存。
